!function(t){function r(o){if(n[o])return n[o].exports;var e=n[o]={exports:{},id:o,loaded:!1};return t[o].call(e.exports,e,e.exports,r),e.loaded=!0,e.exports}var n={};return r.m=t,r.c=n,r.p="",r(0)}([function(t,r,n){var o=n(1);window.onload=function(){var t=document.getElementById("screen"),r=document.getElementById("showPoint"),n=document.getElementById("randomColorToggler"),e=document.getElementById("restart"),i=document.getElementById("pauseToggler");new o(t,r,n,e,i)}},function(t,r,n){"use strict";function o(t,r,n,o,e){this.size=20,this.screen=t,this.showPoint=r,this.restart=o,this.isStop=!1,this.pauseToggler=e,this.screenArray=this.init(22,14),this.count=0,this.randomColorToggler=n,this.randomColor=!1,this.addUnit(),this.stop=this.run(),this.listenEvent()}var e=n(2),i=n(3),a=n(4);o.currUnit=null,o.prototype={init:function(t,r){for(var n=[],o=0;o<t;++o)for(var e=0;e<r;++e)n[o*r+e]=o===t-1||0===e||e===r-1||0===o?1:0;return new i(t,r,n)},addUnit:function(){var t=["i","z","s","l","j","t","o"][e.randi(0,6)],r={row:0,col:e.randi(1,10)};o.currUnit=new a(this.screen,r,this.size,t,this.randomColor&&e.randomColor())},getAbsPosData:function(){return o.currUnit.getAbsPosData()},render:function(t,r){var n=this.size,i=0,a=o.currUnit.dom.getElementsByTagName("div");if("top"===r)for(;i<t.length;++i)e.setStyles(a[i],"top:"+t[i].row*n+"px;");else if("left"===r)for(;i<t.length;++i)e.setStyles(a[i],"left:"+t[i].col*n+"px;");else if(void 0===r)for(;i<t.length;++i)e.setStyles(a[i],"left:"+t[i].col*n+"px;top:"+t[i].row*n+"px;")},resetPos:function(t){var r=t.object.dom,n=t.next||null,o=(t.size||20,t.target),i=o.getAbsPosData(),a=o.screenArray;if(o.check(i,1,0))return o.render(i),void++t.object.wrapPos.row;if(a.rowInfo[0])return o.stop(),window.alert("Game is over!"),"Game is over!";for(var s=0;s<i.length;++s)a.set(i[s].row,i[s].col,1,r.getElementsByTagName("div")[s]);o.render(i);var c=o.checkPoint(),h=c.length;if(h>0){var l=e.max_array(c);o.modifyPos(h,l,c)}return t.object.onkeypress=null,{done:!0,next:n}},modifyPos:function(t,r,n){var o=this.screenArray,i=o.rowInfo,a=o.row,s=this.size;for(var c in i)parseInt(c)<a&&(a=parseInt(c));for(var h,c=r;c>a-1;--c)h=Math.max(c-t,0),o.copy(c,h);for(var l in i){var u=parseInt(l,10);if(!(u>r||u<a)){Math.min(u+t,20);for(var c in i[l]){var d=parseFloat(e.getStyles(i[l][c],"top"));e.setStyles(i[l][c],"top:"+(d+t*s)+"px")}}}for(var f=r;f>a-1;--f)h=Math.max(f-t,0),i[h]?i[f]=i[h].slice():i[f]=0},checkPoint:function(){var t=this.screenArray,r=t.rowInfo,n=[];for(var o in r)if(r[o].length===t.col-2){for(var e in r[o]){var i=r[o][e].parentNode;i.removeChild(r[o][e])}var a=parseInt(o);n.push(a),this.showPoint.innerHTML="<p>"+12*++this.count+"</p>",this.count%4||this.clearDom()}return n},clearDom:function(){for(var t=this.screen,r=Array.prototype.slice.call(t.children),n=r.length,o=0;o<n;++o)r[o].hasChildNodes()||t.removeChild(r[o])},check:function(t,r,n){var o=this.screenArray;for(var e in t){var i=o.get(t[e].row+r,t[e].col+n);if(1===i)return!1}return!0},moveRight:function(t){var r=o.currUnit,n=this.getAbsPosData();if(this.check(n,0,-1))return--r.wrapPos.col,void this.render(n,"left")},moveLeft:function(t){var r=o.currUnit,n=this.getAbsPosData();if(this.check(n,0,1))return++r.wrapPos.col,void this.render(n,"left")},moveDown:function(t){var r=o.currUnit,n=this.getAbsPosData();if(this.check(n,1,0))return++r.wrapPos.row,void this.render(n,"top")},transform:function(){var t=o.currUnit.data.slice(),r=o.currUnit.transform();this.check(r,0,0)?this.render(r):o.currUnit.data=t},listenEvent:function(){var t=this;window.onkeypress=function(r){var r=r||window.event,n=r.keyCode||r.charCode;switch(n){case 97:t.moveRight();break;case 119:t.transform();break;case 100:t.moveLeft();break;case 115:t.moveDown()}},this.randomColorToggler.onclick=function(){t.randomColor=!t.randomColor,t.randomColor?this.innerHTML="随机色关":this.innerHTML="随机色开"},this.restart.onclick=function(){window.history.go(0)},this.pauseToggler.onclick=function(){t.isStop?(t.stop=t.run(),t.isStop=!1,this.innerHTML="暂停"):(t.stop(),t.isStop=!0,this.innerHTML="继续")}},run:function(){var t=!0,r=this,n=function(){t=!0,r.addUnit()},i=setInterval(function(){t===!0&&(t=!1,e.animation(700,r.resetPos,{object:o.currUnit,target:r,next:n}))},1);return function(){window.clearInterval(i),window.cancelAnimationFrame(e.animation.cancelAnimaId)}}},t.exports=o},function(t,r){"use strict";t.exports={getStyles:function(t,r){return window.getComputedStyle?window.getComputedStyle(t,null).getPropertyValue(r):window.currentStyle?window.currentStyle(t).getAttribute(r):void 0},setStyles:function(t,r){var n=t.style.cssText;t.style.cssText=";"===n.substr(-1,1)?n+r:n+";"+r},type:function(t){return Object.prototype.toString.call(t).split(" ")[1].slice(0,-1)},randf:function(t,r){return Math.random()*(r-t)+t},randi:function(t,r){return Math.round(this.randf(t,r))},max_array:function(t){var r=0;for(var n in t)t[n]>r&&(r=t[n]);return r},randomColor:function(){var t=this.randi(0,255),r=this.randi(0,255),n=this.randi(0,255);return t+","+r+","+n},animation:function(t,r,n){if("function"!=typeof r)throw new Error(r.toString()+"is not a function!");var t="Number"===this.type(t)?t:1e3,o=null,n="Object"===this.type(n)?n:{},e=null,i=0,a=this,s=function(c){null===e&&(e=c);var h=c-e;h-i>=t&&(i=h,o=r(n)),void 0==o?a.animation.cancelAnimaId=requestAnimationFrame(s):o.next&&"Function"===a.type(o.next)&&o.next()};requestAnimationFrame(s)}}},function(t,r){"use strict";function n(t,r,n){this.row=t,this.col=r,this.data=n,this.rowInfo={}}n.prototype={get:function(t,r){return this.check(t,r),this.data[t*this.col+r]},set:function(t,r,n,o){this.check(t,r),this.data[t*this.col+r]=n,void 0!==o&&(this.rowInfo[t]||(this.rowInfo[t]=[]),this.rowInfo[t].push(o))},copy:function(t,r){for(var n=this.col,o=0;o<n;++o)this.set(t,o,this.get(r,o))},map:function(t){var r,n,o=(this.data,this.row),e=this.col;for(r=0;r<o;++r)for(n=0;n<e;++n)t(this.get(r,n),r,n)},check:function(t,r){var n=t*this.col+r,o=this.data;if(n>o.length)throw new Error("get the data: ("+n+") is overflow rang:"+o.length)},dump:function(){for(var t=this.row,r=0,n=this.col,o=(this.data,0);o<t;++o){console.log(r++ +"_>.   __"+t+" | "+n);for(var e="",i="_",a=0;a<n;++a)e+=this.get(o,a)+" | ",i+="____";console.log(e),console.log(i)}}},t.exports=n},function(t,r,n){"use strict";function o(t,r,n,o,e){this.wrapPos=r,this.size=n,this.data=[],this.color=e,this.init(t,r,o)}var e=n(2),i=n(3),a={i:[{r:1,c:4,data:"1111"},{r:4,c:1,data:"1111"}],z:[{r:2,c:3,data:"110011"},{r:3,c:2,data:"011110"}],s:[{r:2,c:3,data:"011110"},{r:3,c:2,data:"101101"}],t:[{r:2,c:3,data:"111010"},{r:3,c:2,data:"011101"},{r:2,c:3,data:"010111"},{r:3,c:2,data:"101110"}],l:[{r:3,c:2,data:"101011"},{r:2,c:3,data:"111100"},{r:3,c:2,data:"110101"},{r:2,c:3,data:"001111"}],j:[{r:3,c:2,data:"010111"},{r:2,c:3,data:"100111"},{r:3,c:2,data:"111010"},{r:2,c:3,data:"111001"}],o:[{r:2,c:2,data:"1111"}]};o.prototype={init:function(t,r,n){var o=e.randi(0,a[n].length-1),i=a[n][o];this.typeInfo={type:a[n],index:o},this.createUnits(t,i)},createUnits:function(t,r){var n=document.createElement("div");this.initPos(new i(r.r,r.c,r.data));for(var o=this.getAbsPosData(),e=o.length,a=0;a<e;++a){var s=this.createUnit(o[a],this.color);s.setAttribute("class","unit"),n.appendChild(s)}t.appendChild(n),this.dom=n},createUnit:function(t,r){var n=document.createElement("div"),o=this.size;return e.setStyles(n,"left:"+t.col*o+"px;top:"+t.row*o+"px;background-color: rgb("+r+");"),n},getAbsPosData:function(){var t=this.data,r=[],n=0,o=0;for(var e in t)n=Math.max(t[e].row+this.wrapPos.row-20,n),o=Math.max(t[e].col+this.wrapPos.col-12,o);o>0&&(this.wrapPos.col-=o),n>0&&(this.wrapPos.row-=n);for(var e in t)r.push({row:t[e].row+this.wrapPos.row,col:t[e].col+this.wrapPos.col});return r},initPos:function(t){var r=this;r.data.length=0,t.map(function(t,n,o){"1"===t&&r.data.push({row:n,col:o})})},transform:function(){var t=this.typeInfo.type,r=t.length,n=t[++this.typeInfo.index%r];return this.initPos(new i(n.r,n.c,n.data)),this.getAbsPosData()}},t.exports=o}]);