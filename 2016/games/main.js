!function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return t[r].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){var r=n(1),i=(n(5),n(2));void 0===window.requestAnimationFrame?document.write("浏览器版本太低 ,请选择谷歌浏览器，火狐浏览器，IE10+"):document.onreadystatechange=function(){function t(){var t,r=i.getInner(),s=Math.min(r.width,480),a=r.height,c=3,u=document.getElementById("gameWrap");t=Math.floor(s/(12+c))>Math.floor(a/(21+c))?Math.floor(a/(21+c)):Math.floor(s/(12+c));var d=t*(21+c),p=t*(12+c);if(p<165)return document.write("屏幕尺寸太小"),!1;var f=(a-d)/2,g=13*t+1,m=21*t+1;i.setStyles(n,"height:"+2*t+"px;width:98%;font-size:"+t+"px;line-height:1px"),i.setStyles(h,"margin-top:"+1.5*t+"px;height:"+(1.5*t+2)+"px"),i.setStyles(o,"margin-top:"+(3*t+20)+"px"),i.setStyles(h.getElementsByTagName("label")[0],"font-size:"+t/1.5+"px;height:"+t/1.2+"px;"),i.setStyles(document.getElementById("setting"),"width:"+(p-g+(t-2))+"px;height:"+m+"px"),i.setStyles(e,"width:"+g+"px;height:"+m+"px;left:-"+t+"px"),i.setStyles(l,"height:"+10*t+"px;top:"+(d-10*t-80)/2+"px;"),i.setStyles(l.getElementsByTagName("button")[0],"height:"+2*t+"px;bottom:"+t+"px;font-size:"+t/1.5+"px;"),i.setStyles(document.getElementById("copyright"),"width:"+p+"px");var v=document.styleSheets,w=v[v.length-1];return w.insertRule?(w.insertRule(".unit{width:"+t+"px;height:"+t+"px;}",w.cssRules.length),w.insertRule("#guide button{margin-top:5px;font-size:"+t+"px;height:"+2*t+"px;}",w.cssRules.length),w.insertRule("#randomColorToggler,#restart,#pauseToggler{height:"+t+"px;font-size:"+t/1.5+"px;margin-top:"+1.5*t+"px;}",w.cssRules.length)):w.addRule&&(w.addRule(".unit","width:"+t+"px;height:"+t+"px;",w.rules.length),w.addRule("#guide button","margin-top:5px;font-size:"+t+"px;height:"+2*t+"px;",w.rules.length),w.insertRule("#randomColorToggler,#restart,#pauseToggler","height:"+t+"px;font-size:"+t/1.5+"px;margin-top:"+1.5*t+"px;",w.rules.length)),i.setStyles(u,"width:"+p+"px;height:"+d+"px;top:"+f+"px;display:block;"),t}if("complete"===document.readyState){var e=document.getElementById("screen"),n=document.getElementById("showPoint"),o=document.getElementById("randomColorToggler"),s=document.getElementById("restart"),a=document.getElementById("pauseToggler"),c={up:document.getElementById("up"),down:document.getElementById("down"),left:document.getElementById("left"),right:document.getElementById("right")},l=document.getElementById("dialog"),h=document.getElementById("rate"),u=t();if(u!==!1){var d=new r(e,n,u,l,h);d.listenEvent(o,s,a,c)}}}},function(t,e,n){"use strict";function r(t,e,n,r,i){this.size=n,this.screen=t,this.dialog=r,this.isStop=!1,this.row=22,this.col=14,this.oRate=i,this.count=0,this.showPoint=e,this.currRate=0,this.randomColor=!1,this.screenArray=this.init(this.row,this.col),this.addUnit(),this.stop=this.run()}var i=n(2),o=n(3),s=n(4);r.currUnit=null,r.prototype={init:function(t,e){for(var n=[],r=0;r<t;++r)for(var i=0;i<e;++i)n[r*e+i]=r===t-1||0===i||i===e-1||0===r?1:0;return new o(t,e,n)},addUnit:function(){var t=["i","z","s","l","j","t","o"][i.randi(0,6)],e={row:0,col:i.randi(1,9)};r.currUnit=new s(e),r.currUnit.init(this.screen,t,this.randomColor&&i.randomColor()+",0.5",this.size,this.row,this.col)},getAbsPosData:function(){return r.currUnit.getAbsPosData(this.row,this.col)},render:function(t,e){var n=this.size,o=0,s=r.currUnit.dom.getElementsByTagName("div");if("top"===e)for(;o<t.length;++o)i.setStyles(s[o],"top:"+t[o].row*n+"px;");else if("left"===e)for(;o<t.length;++o)i.setStyles(s[o],"left:"+t[o].col*n+"px;");else if(void 0===e)for(;o<t.length;++o)i.setStyles(s[o],"left:"+t[o].col*n+"px;top:"+t[o].row*n+"px;")},messagebox:function(t){var e=this.dialog.getElementsByTagName("span")[0];e.innerHTML=t,i.setStyles(this.dialog,"visibility:visible;")},resetPos:function(t){var e=t.currUnit.dom,n=t.next||null,r=t._this,o=(r.size,r.getAbsPosData()),s=r.screenArray;if(r.check(o,1,0))return r.render(o),void++t.currUnit.wrapPos.row;if(s.rowInfo[0])return r.stop(),r.messagebox("Game over"),"Game is over!";for(var a=0;a<o.length;++a)s.set(o[a].row,o[a].col,1,e.getElementsByTagName("div")[a]);r.render(o);var c=r.checkPoint(),l=c.length;if(l>0){var h=i.max_array(c);r.modifyPos(l,h,c)}return t.currUnit.onkeypress=null,{done:!0,next:n}},modifyPos:function(t,e,n){var r=this.screenArray,o=r.rowInfo,s=r.row,a=this.size;for(var c in o)parseInt(c)<s&&(s=parseInt(c));for(var l,c=e;c>s-1;--c)l=Math.max(c-t,0),r.copy(c,l);for(var h in o){var u=parseInt(h,10);if(!(u>e||u<s)){Math.min(u+t,this.row-2);for(var c in o[h]){var d=parseFloat(i.getStyles(o[h][c],"top"));i.setStyles(o[h][c],"top:"+(d+t*a)+"px")}}}for(var p=e;p>s-1;--p)l=Math.max(p-t,0),o[l]?o[p]=o[l].slice():o[p]=0},checkPoint:function(){var t=this.screenArray,e=t.rowInfo,n=[];for(var r in e)if(e[r].length===t.col-2){for(var i in e[r]){var o=e[r][i].parentNode;o.removeChild(e[r][i])}var s=parseInt(r);n.push(s),this.showPoint.innerHTML="<p>"+12*++this.count+"</p>";var a=[10,100,300,600,1e3,2e3];if(12*this.count>a[this.currRate]){var c=++this.currRate,l=this.oRate.getElementsByTagName("label")[0],h=document.getElementById("progress");l.innerHTML="难度:<span>"+c+"</span>",h.setAttribute("value",10*c),this.messagebox('难度升级为:<span color="red">'+c+"</span>"),this.isStop||(this.stop(),this.isStop=!0)}this.count%4||this.clearDom()}return n},clearDom:function(){for(var t=this.screen,e=Array.prototype.slice.call(t.children),n=e.length,r=0;r<n;++r)e[r].hasChildNodes()||t.removeChild(e[r])},check:function(t,e,n){var r=this.screenArray;for(var i in t){var o=r.get(t[i].row+e,t[i].col+n);if(1===o)return!1}return!0},moveRight:function(t){var e=r.currUnit,n=this.getAbsPosData();if(this.check(n,0,-1))return--e.wrapPos.col,void this.render(n,"left")},moveLeft:function(t){var e=r.currUnit,n=this.getAbsPosData();if(this.check(n,0,1))return++e.wrapPos.col,void this.render(n,"left")},moveDown:function(t){var e=r.currUnit,n=this.getAbsPosData();if(this.check(n,1,0))return++e.wrapPos.row,void this.render(n,"top")},transform:function(){var t=r.currUnit.data.slice(),e=r.currUnit.transform(this);e?this.render(e):r.currUnit.data=t},listenEvent:function(t,e,n,r){var o=this,s=o.dialog.getElementsByTagName("button")[0];window.onkeypress=function(t){var t=t||window.event,e=t.keyCode||t.charCode;switch(e){case 97:case 65:o.moveRight();break;case 119:case 87:o.transform();break;case 100:case 68:o.moveLeft();break;case 115:case 83:o.moveDown()}},s.onclick=function(){o.isStop&&(o.stop=o.run(),o.isStop=!1),i.setStyles(o.dialog,"visibility:hidden;")},r.up.onclick=function(){o.transform()},r.down.onclick=function(){o.moveDown()},r.left.onclick=function(){o.moveRight()},r.right.onclick=function(){o.moveLeft()},t.onclick=function(){o.randomColor=!o.randomColor,o.randomColor?this.innerHTML="随机色关":this.innerHTML="随机色开"},e.onclick=function(){i.isWeiXin()?i.updateUrl(window.location.href):location.reload()},n.onclick=function(){o.isStop?(o.stop=o.run(),o.isStop=!1,this.innerHTML="暂停"):(o.stop(),o.isStop=!0,this.innerHTML="继续")}},run:function(){var t=!0,e=this,n=function(){t=!0,e.addUnit()},o=[700,600,500,400,300,200],s=setInterval(function(){t===!0&&(t=!1,i.animation(o[e.currRate],e.resetPos,{currUnit:r.currUnit,_this:e,next:n}))},1);return function(){window.clearInterval(s),window.cancelAnimationFrame(i.animation.cancelAnimaId)}}},t.exports=r},function(t,e){"use strict";t.exports={getStyles:function(t,e){return window.getComputedStyle?window.getComputedStyle(t,null).getPropertyValue(e):window.currentStyle?window.currentStyle(t).getAttribute(e):void 0},setStyles:function(t,e){var n=t.style.cssText;t.style.cssText=";"===n.substr(-1,1)?n+e:n+";"+e},type:function(t){return Object.prototype.toString.call(t).split(" ")[1].slice(0,-1)},randf:function(t,e){return Math.random()*(e-t)+t},randi:function(t,e){return Math.round(this.randf(t,e))},max_array:function(t){var e=0;for(var n in t)t[n]>e&&(e=t[n]);return e},randomColor:function(){var t=this.randi(0,255),e=this.randi(0,255),n=this.randi(0,255);return t+","+e+","+n},getInner:function(){var t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,e=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;return{height:t,width:e}},isWeiXin:function(){var t=window.navigator.userAgent.toLowerCase();return"micromessenger"==t.match(/MicroMessenger/i)},updateUrl:function(t,e){var e=(e||"t")+"=",n=new RegExp(e+"\\d+");t=t.search(n)===-1?t+"?"+e+(new Date).getTime():t.replace(n,e+(new Date).getTime()),window.location.replace(t)},insertRule:function(t,e,n){if(t.insertRule){var r=e+"{"+n+"}";t.insertRule(r,t.cssRules.length)}else t.addRule&&t.addRule(e,n,t.rules.length)},animation:function(t,e,n){if("function"!=typeof e)throw new Error(e.toString()+"is not a function!");var t="Number"===this.type(t)?t:1e3,r=null,n="Object"===this.type(n)?n:{},i=null,o=0,s=this,a=function(c){null===i&&(i=c);var l=c-i;l-o>=t&&(o=l,r=e(n)),void 0==r?s.animation.cancelAnimaId=requestAnimationFrame(a):r.next&&"Function"===s.type(r.next)&&r.next()};requestAnimationFrame(a)}}},function(t,e){"use strict";function n(t,e,n){this.row=t,this.col=e,this.data=n,this.rowInfo={}}n.prototype={get:function(t,e){return this.check(t,e),this.data[t*this.col+e]},set:function(t,e,n,r){this.check(t,e),this.data[t*this.col+e]=n,void 0!==r&&(this.rowInfo[t]||(this.rowInfo[t]=[]),this.rowInfo[t].push(r))},copy:function(t,e){for(var n=this.col,r=0;r<n;++r)this.set(t,r,this.get(e,r))},map:function(t){var e,n,r=(this.data,this.row),i=this.col;for(e=0;e<r;++e)for(n=0;n<i;++n)t(this.get(e,n),e,n)},check:function(t,e){var n=t*this.col+e,r=this.data;if(n>r.length)throw new Error("get the data: ("+n+") is overflow rang:"+r.length)},dump:function(){for(var t=this.row,e=0,n=this.col,r=(this.data,0);r<t;++r){console.log(e++ +"_>.   __"+t+" | "+n);for(var i="",o="_",s=0;s<n;++s)i+=this.get(r,s)+" | ",o+="____";console.log(i),console.log(o)}}},t.exports=n},function(t,e,n){"use strict";function r(t,e,n){this.wrapPos=t,this.data=[]}var i=n(2),o=n(3),s={i:[{r:1,c:4,data:"1111"},{r:4,c:1,data:"1111"}],z:[{r:2,c:3,data:"110011"},{r:3,c:2,data:"011110"}],s:[{r:2,c:3,data:"011110"},{r:3,c:2,data:"101101"}],t:[{r:2,c:3,data:"111010"},{r:3,c:2,data:"011101"},{r:2,c:3,data:"010111"},{r:3,c:2,data:"101110"}],l:[{r:3,c:2,data:"101011"},{r:2,c:3,data:"111100"},{r:3,c:2,data:"110101"},{r:2,c:3,data:"001111"}],j:[{r:3,c:2,data:"010111"},{r:2,c:3,data:"100111"},{r:3,c:2,data:"111010"},{r:2,c:3,data:"111001"}],o:[{r:2,c:2,data:"1111"}]};r.prototype={init:function(t,e,n,r,o,a){var c=i.randi(0,s[e].length-1),l=s[e][c];this.pos;this.typeInfo={type:s[e],index:c},this.createUnits(t,l,n,r,o,a)},createUnits:function(t,e,n,r,i,s){var a=document.createElement("div");this.initPos(new o(e.r,e.c,e.data));for(var c=this.getAbsPosData(),l=c.length,h=0;h<l;++h){var u=this.createUnit(c[h],n,r);u.setAttribute("class","unit"),a.appendChild(u)}t.appendChild(a),this.dom=a},createUnit:function(t,e,n){var r=document.createElement("div");return i.setStyles(r,"left:"+t.col*n+"px;top:"+t.row*n+"px;background-color: rgba("+e+");"),r},getAbsPosData:function(t,e){var n=this.data,r=[],i=0,o=0;for(var s in n)i=Math.max(n[s].row+this.wrapPos.row-(t-2),i),o=Math.max(n[s].col+this.wrapPos.col-(e-2),o);o>0&&(this.wrapPos.col-=o),i>0&&(this.wrapPos.row-=i);for(var s in n)r.push({row:n[s].row+this.wrapPos.row,col:n[s].col+this.wrapPos.col});return r},initPos:function(t){var e=this;e.data.length=0,t.map(function(t,n,r){"1"===t&&e.data.push({row:n,col:r})})},transform:function(t){var e=this.typeInfo.type,n=e.length,r=e[++this.typeInfo.index%n];this.initPos(new o(r.r,r.c,r.data));var i=this.getAbsPosData(t.row,t.col);return t.check(i,0,0)?(t=null,i):(t=null,--this.typeInfo.index,!1)}},t.exports=r},function(t,e){}]);